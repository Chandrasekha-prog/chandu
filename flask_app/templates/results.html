{% extends "layout.html" %}

{% block content %}
<div class="max-w-4xl mx-auto mb-10">
    <div class="flex items-center gap-4 mb-6">
        <a href="{{ url_for('dashboard') }}"
            class="text-gray-500 hover:text-gray-700 bg-white shadow-sm p-2 rounded-lg border border-gray-200 transition-colors">
            ‚Üê Dashboard
        </a>
        <div>
            <span
                class="bg-green-100 text-green-800 text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider mb-1 inline-block">
                Recommendation Ready
            </span>
            <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-2">
                üåæ {{ recommendation.english_name }} Report
            </h1>
        </div>
    </div>

    <!-- Summary Section -->
    <div class="card mb-6 bg-gradient-to-r from-primary-50 to-white">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <div>
                <p class="text-sm text-gray-500 uppercase font-semibold">Location</p>
                <p class="font-bold text-gray-800 mt-1">{{ recommendation.district }}, {{ recommendation.mandal }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 uppercase font-semibold">Area Sown</p>
                <p class="font-bold text-gray-800 mt-1">{{ recommendation.area_sown }} Acres</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 uppercase font-semibold">Sown Date</p>
                <p class="font-bold text-gray-800 mt-1">{{ recommendation.sowing_date }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 uppercase font-semibold">Growth Stage</p>
                <p class="font-bold text-primary-600 mt-1 capitalize">{{ recommendation.current_stage }} ({{
                    recommendation.days_after_sowing }} days)</p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Content -->
        <div class="lg:col-span-2 space-y-6">

            <!-- Fertilizers -->
            <div class="card">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-4">
                    üß™ Required Fertilizers
                </h2>

                {% if recommendation.fertilizers %}
                <div class="space-y-4">
                    {% for fert in recommendation.fertilizers %}
                    <div
                        class="bg-gray-50 rounded-xl p-5 border border-gray-100 flex justify-between items-center hover:shadow-md transition-shadow">
                        <div>
                            <div class="flex items-center gap-3 mb-1">
                                <h3 class="font-bold text-lg text-gray-800">{{ fert.name }}</h3>
                                <span class="bg-primary-100 text-primary-800 text-xs px-2 py-0.5 rounded font-mono">{{
                                    fert.nutrient }}</span>
                            </div>
                            <p class="text-sm text-gray-600 flex items-center gap-1">‚åö {{ fert.timing }}</p>
                            <p class="text-xs text-gray-500 mt-1">Cost: ‚Çπ{{ fert.cost }}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-2xl font-black text-primary-600">{{ fert.amount_kg }}<span
                                    class="text-sm font-normal text-gray-500">kg</span></p>
                            <p class="text-sm text-gray-500">{{ fert.amount_per_acre }} kg/acre</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="bg-green-50 text-green-700 p-4 rounded-lg flex items-center gap-3">
                    No chemical fertilizers needed at this stage!
                </div>
                {% endif %}
            </div>

            <!-- Notes & Advice -->
            <div class="card">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-4">
                    üí° Important Guidelines
                </h2>
                <ul class="space-y-3">
                    {% for note in recommendation.notes %}
                    <li class="flex items-start gap-3 text-gray-700 bg-gray-50 p-3 rounded-lg border border-gray-100">
                        <span class="text-primary-500 mt-0.5">‚úì</span>
                        <span>{{ note }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <!-- Stage Schedule -->
            {% if recommendation.stage_schedule %}
            <div class="card">
                <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2 mb-4">
                    üìÖ Schedule
                </h2>
                <div class="overflow-hidden rounded-lg border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200 text-sm">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-3 text-left font-semibold text-gray-900">Stage</th>
                                <th class="px-4 py-3 text-left font-semibold text-gray-900">Application Window</th>
                                <th class="px-4 py-3 text-left font-semibold text-gray-900">Urea</th>
                                <th class="px-4 py-3 text-left font-semibold text-gray-900">DAP</th>
                                <th class="px-4 py-3 text-left font-semibold text-gray-900">MOP</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 bg-white">
                            {% for stage in recommendation.stage_schedule %}
                            <tr>
                                <td class="px-4 py-3 font-medium text-gray-900">{{ stage.stage }}</td>
                                <td class="px-4 py-3 text-gray-500">{{ stage.days_from_sowing }}</td>
                                <td class="px-4 py-3 text-gray-700">{{ stage.fertilizers.Urea }}</td>
                                <td class="px-4 py-3 text-gray-700">{{ stage.fertilizers.DAP }}</td>
                                <td class="px-4 py-3 text-gray-700">{{ stage.fertilizers.MOP }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

        </div>

        <!-- Sidebar / Economics -->
        <div class="space-y-6">
            <div class="card bg-gray-900 text-white border-0 shadow-2xl">
                <h2 class="text-xl font-bold mb-4 text-gray-100">Economics</h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center border-b border-gray-700 pb-3">
                        <span class="text-gray-400">Total Estimated Cost</span>
                        <span class="text-2xl font-black text-green-400">‚Çπ{{ recommendation.total_cost }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Expected Yield Boost</span>
                        <span class="font-bold text-primary-300">~{{ recommendation.expected_yield_increase }}</span>
                    </div>
                </div>
            </div>

            <!-- Soil Parameters -->
            <div class="card bg-blue-50 border-blue-100 text-blue-900">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                    üåç Local Soil Profile
                </h2>
                <div class="grid grid-cols-2 gap-3 text-sm">
                    <div class="bg-white/60 p-2 rounded border border-blue-200/50 text-center">
                        <p class="text-xs uppercase font-bold text-blue-600/70">pH</p>
                        <p class="font-mono text-lg font-medium">{{ recommendation.soil_parameters.pH }}</p>
                    </div>
                    <div class="bg-white/60 p-2 rounded border border-blue-200/50 text-center">
                        <p class="text-xs uppercase font-bold text-blue-600/70">Organic C</p>
                        <p class="font-mono text-lg font-medium">{{ recommendation.soil_parameters.OC }}%</p>
                    </div>
                    <div class="bg-white/60 p-2 rounded border border-blue-200/50 text-center col-span-2 mt-2">
                        <div class="flex justify-around mt-1">
                            <span><strong class="text-blue-700">N:</strong> {{ recommendation.soil_parameters.N
                                }}</span>
                            <span><strong class="text-blue-700">P:</strong> {{ recommendation.soil_parameters.P
                                }}</span>
                            <span><strong class="text-blue-700">K:</strong> {{ recommendation.soil_parameters.K
                                }}</span>
                        </div>
                        <p class="text-[10px] text-blue-500 uppercase mt-1">Available Nutrients (kg/ha)</p>
                    </div>
                </div>
            </div>

            <!-- Weather Alert -->
            {% if recommendation.weather_analysis and recommendation.weather_analysis.weather_notes %}
            <div class="card bg-orange-50 border-orange-200">
                <h2 class="text-lg font-bold text-orange-800 flex items-center gap-2 mb-3">
                    üå§Ô∏è Weather Notice
                </h2>
                <ul class="text-sm text-orange-700 space-y-2">
                    {% for wn in recommendation.weather_analysis.weather_notes %}
                    <li class="flex gap-2"><span>‚Ä¢</span> {{ wn }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}